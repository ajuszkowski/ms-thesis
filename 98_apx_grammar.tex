%\vspace{-3em}
%TODO: grammar highlight with bold font!
%\begin{figure}[h!]%[H]
\begin{multicols*}{2}
[
\section{The ANTLR grammar for the \texttt{porthos\,v1} input language}
\label{apx:grammar}
]
\begin{lstlisting}[language=antlr,
        basicstyle=\tiny,
        linewidth=.56\textwidth]
grammar Porthos;

main
  :   program
  ;

bool_expression
  :   bool_atom
  |   bool_atom BOOL_OP bool_atom
  ;

bool_atom
  :   TRUE
  |   FALSE
  |   '(' arith_expr COMP_OP arith_expr ')'
  |   '(' bool_expression ')'
  ;

arith_expr
  :   arith_atom ARITH_OP arith_atom
  |   arith_atom
  ;

arith_atom
  :   DIGIT
  |   register
  |   '(' arith_expr ')'
  ;

register
  :   WORD
  ;

location
  :   WORD
  ;

local
  :   register '<-' arith_expr
  ;

load
  :   register '<:-' location
  ;

store
  :   location ':=' register
  ;

read
  :   register '=' location '.' 'load' '(' 
     ATOMIC ')'
  ;

write
  :   location '.' 'store' '(' ATOMIC ',' 
     register ')'
  ;

instruction
  :   atom
  |   sequence
  |   while_
  |   if
  ;

atom
  :   local
  |   load
  |   store
  |   FENCE
  |   read
  |   write
  ;

sequence
  :   atom    ';' instruction
  |   while_  ';' instruction
  |   if      ';' instruction
  ;

if
  :   'if' bool_expression 'then' '{' instruction '}' 
     ('else' '{' instruction '}')?
  ;

while_
  :   'while' bool_expression '{' instruction '}'
  ;

program
  :   '{' location (',' location)* '}'
       ('thread t' DIGIT '{' instruction '}'
         ('exists' (location '=' DIGIT ','
         | DIGIT ':' register '=' DIGIT ',')   
         )*
       )*
  ;

// Lexer rules:

ATOMIC
  :   '_na' | '_sc' | '_rx' | '_acq' | '_rel' | '_con'
  ;

FENCE
  :   'mfence' | 'sync' | 'lwsync' | 'isync'
  ;
    
COMP_OP  : '=='  | '!='  | '<=' | '<' | '>=' | '>';
ARITH_OP : '+'   | '-'   | '*'  | '/' | '%';
BOOL_OP  : 'and' | 'or';

DIGIT  : [0-9];
LETTER : 'a'..'z' | 'A'..'Z';
TRUE   : 'true'   | 'True';
FALSE  : 'false'  | 'False';
WORD   : (LETTER | DIGIT)+;
\end{lstlisting}
\end{multicols*}
%\end{figure}


%\begin{multicols*}{2}
%[
%\section{The ANTLR grammar for the \texttt{cat} language}
%\label{apx:catgrammar}
%]
%\lstinputlisting{inc/lst/grammars/Cat.g4}
%\end{multicols*}